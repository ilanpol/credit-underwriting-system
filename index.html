// ×”×¡×ª×¨×ª ×”×¦×¢×•×ª
        function hideSuggestions() {
            document.getElementById('payerSuggestions').style.display = 'none';
            document.getElementById('customerSuggestions').style.display = 'none';
        }

        // ×¨×¢× ×•×Ÿ autocomplete
        function refreshAutocomplete() {
            // ×¢×“×›×•×Ÿ ×¨×©×™××•×ª ×”×”×¦×¢×•×ª
            console.log('Autocomplete ××¢×•×“×›×Ÿ:', payersData.length, '××•×©×›×™×,', customersData.length, '×œ×§×•×—×•×ª');
        }

        // ×—×™×©×•×‘ ×“×™×¨×•×’ ××©×¨××™
        function calculateRating() {
            const payerName = document.getElementById('payerName').value;
            const payerID = document.getElementById('payerID').value;
            const customerName = document.getElementById('customerName').value;
            const customerID = document.getElementById('customerID').value;
            const checkAmount = parseFloat(document.getElementById('checkAmount').value);
            const paymentDate = document.getElementById('paymentDate').value;
            const bankCode = document.getElementById('bankCode').value;
            const branchCode = document.getElementById('branchCode').value;

            // ×‘×“×™×§×ª ×©×“×•×ª ×—×•×‘×”
            if (!payerName || !customerName || !checkAmount) {
                alert('×× × ××œ× ××ª ×”×©×“×•×ª ×”×—×•×‘×”: ×©× ××•×©×š, ×©× ×œ×§×•×— ×•×¡×›×•× ×”×©×™×§');
                return;
            }

            // ×§×‘×œ×ª × ×ª×•× ×™ ××•×©×š ××”×××’×¨
            const payerData = findPayerData(payerID || payerName);
            const customerData = findCustomerData(customerID || customerName);
            const dbRecord = findDBData(payerID);

            // ×—×™×©×•×‘ ×™××™ ××©×¨××™
            const today = new Date();
            const payment = paymentDate ? new Date(paymentDate) : new Date(today.getTime() + 46*24*60*60*1000);
            const creditDays = Math.ceil((payment - today) / (1000 * 60 * 60 * 24));

            // ×—×™×©×•×‘ ×¤×¨××˜×¨×™ ×”×“×™×¨×•×’ ×¢× × ×ª×•× ×™× ×××™×ª×™×™×
            const parameters = calculateAllParameters(payerData, customerData, dbRecord, checkAmount, creditDays);

            // ×—×™×©×•×‘ ×¦×™×•×Ÿ ×¡×•×¤×™
            let finalScore = 0;
            parameters.forEach(param => {
                finalScore += (param.normalizedValue * param.weight) / 100;
            });

            // ×”×’×‘×œ×ª ×”×¦×™×•×Ÿ ×‘×™×Ÿ 0-100
            finalScore = Math.max(0, Math.min(100, finalScore * 100));

            // ×§×‘×™×¢×ª ×“×™×¨×•×’
            const rating = getRatingFromScore(finalScore);

            // ×§×‘×™×¢×ª ×”××œ×¦×”
            const { recommendation, recommendationClass } = getRecommendation(finalScore);

            // ×”×¦×’×ª ×”×ª×•×¦××•×ª
            displayResults({
                payerName,
                customerName,
                payerID,
                customerID,
                checkAmount,
                creditDays,
                finalScore,
                rating,
                recommendation,
                recommendationClass,
                parameters,
                payerData,
                customerData,
                dbRecord,
                bankCode,
                branchCode
            });
        }

        // ×—×™×¤×•×© × ×ª×•× ×™ ××•×©×š
        function findPayerData(identifier) {
            if (!identifier) return getDefaultPayerData();
            
            let payer = payersData.find(p => p.id === identifier || p.name === identifier);
            
            if (!payer) {
                // ×—×™×¤×•×© ×‘××§×•×¨×•×ª × ×•×¡×¤×™×
                payer = transactionsData.find(t => 
                    t['××¡×¤×¨ ×–×”×•×ª ××•×©×š'] === identifier || t['×©× ××•×©×š'] === identifier
                );
                
                if (payer) {
                    payer = {
                        name: payer['×©× ××•×©×š'],
                        id: payer['××¡×¤×¨ ×–×”×•×ª ××•×©×š'],
                        transactions: countPayerTransactions(payer['××¡×¤×¨ ×–×”×•×ª ××•×©×š']),
                        totalAmount: sumPayerTransactions(payer['××¡×¤×¨ ×–×”×•×ª ××•×©×š']),
                        returnedChecks: countReturnedChecks(payer['××¡×¤×¨ ×–×”×•×ª ××•×©×š'])
                    };
                }
            }
            
            return payer || getDefaultPayerData();
        }

        // ×—×™×¤×•×© × ×ª×•× ×™ ×œ×§×•×—
        function findCustomerData(identifier) {
            if (!identifier) return getDefaultCustomerData();
            
            let customer = customersData.find(c => c.id === identifier || c.name === identifier);
            
            if (!customer) {
                customer = transactionsData.find(t => 
                    t['×.×–×”×•×ª'] === identifier || t['×©× ×œ×§×•×—'] === identifier
                );
                
                if (customer) {
                    customer = {
                        name: customer['×©× ×œ×§×•×—'],
                        id: customer['×.×–×”×•×ª'],
                        transactions: countCustomerTransactions(customer['×.×–×”×•×ª']),
                        totalAmount: sumCustomerTransactions(customer['×.×–×”×•×ª'])
                    };
                }
            }
            
            return customer || getDefaultCustomerData();
        }

        // ×—×™×¤×•×© × ×ª×•× ×™ D&B
        function findDBData(payerID) {
            if (!payerID || dbData.length === 0) {
                return getDefaultDBData();
            }
            
            const dbRecord = dbData.find(record => 
                record['××¡\' ×—.×¤'] === payerID || record['××¡×¤×¨ ×–×”×•×ª'] === payerID
            );
            
            return dbRecord || getDefaultDBData();
        }

        // ×—×™×©×•×‘ ×›×œ ×”×¤×¨××˜×¨×™×
        function calculateAllParameters(payerData, customerData, dbRecord, checkAmount, creditDays) {
            const dbScore = parseFloat(dbRecord?.['×¡×§×•×¨']) || payerData.dbScore || 38.704;
            const sectorScore = parseFloat(dbRecord?.['×¡×§×•×¨ ×¢× ×£']) || payerData.sectorScore || 29;
            const companyAge = parseInt(dbRecord?.['×©× ×•×ª ×•×ª×§']) || payerData.companyAge || 0;
            const employeeCount = parseInt(dbRecord?.['××¡\' ××•×¢×¡×§×™×']) || payerData.employeeCount || 0;
            const annualTurnover = parseFloat(dbRecord?.['××—×–×•×¨ ×‘×\' â‚ª']) || payerData.annualTurnover || 0;

            return [
                {
                    name: '××¡×¤×¨ ×¢×¡×§××•×ª ×§×•×“××•×ª',
                    weight: 15,
                    rawValue: payerData.transactions || 0,
                    normalizedValue: calculateTransactionsScore(payerData.transactions || 0),
                    reason: getTransactionsReason(payerData.transactions || 0),
                    status: getTransactionsStatus(payerData.transactions || 0)
                },
                {
                    name: '××¡×¤×¨ ×—×–×¨×•×ª ×©×™×§×™×',
                    weight: 5,
                    rawValue: payerData.returnedChecks || 0,
                    normalizedValue: calculateReturnedChecksScore(payerData.returnedChecks || 0),
                    reason: getReturnedChecksReason(payerData.returnedChecks || 0),
                    status: getReturnedChecksStatus(payerData.returnedChecks || 0)
                },
                {
                    name: '×—×¨×™×’×” ××××•×¦×¢ ×™××™ ××©×¨××™',
                    weight: 10,
                    rawValue: creditDays,
                    normalizedValue: calculateCreditDaysScore(creditDays),
                    reason: getCreditDaysReason(creditDays),
                    status: getCreditDaysStatus(creditDays)
                },
                {
                    name: '×“×™×¨×•×’ D&B',
                    weight: 8,
                    rawValue: dbScore,
                    normalizedValue: calculateDBScore(dbScore),
                    reason: getDBReason(dbScore),
                    status: getDBStatus(dbScore)
                },
                {
                    name: '×“×™×¨×•×’ ×¢× ×£',
                    weight: 5,
                    rawValue: sectorScore,
                    normalizedValue: calculateSectorScore(sectorScore),
                    reason: getSectorReason(sectorScore),
                    status: getSectorStatus(sectorScore)
                },
                {
                    name: '××¡×•×›× ×ª ××”×¢× ×£',
                    weight: 8,
                    rawValue: dbScore - sectorScore,
                    normalizedValue: calculateSectorRiskScore(dbScore, sectorScore),
                    reason: getSectorRiskReason(dbScore, sectorScore),
                    status: getSectorRiskStatus(dbScore, sectorScore)
                },
                {
                    name: '×’×™×œ ×”×—×‘×¨×”',
                    weight: 13,
                    rawValue: companyAge,
                    normalizedValue: calculateCompanyAgeScore(companyAge),
                    reason: getCompanyAgeReason(companyAge),
                    status: getCompanyAgeStatus(companyAge)
                },
                {
                    name: '××—×–×•×¨ ×©× ×ª×™',
                    weight: 3,
                    rawValue: annualTurnover,
                    normalizedValue: calculateTurnoverScore(annualTurnover),
                    reason: getTurnoverReason(annualTurnover),
                    status: getTurnoverStatus(annualTurnover)
                }
            ];
        }

        // ×¤×•× ×§×¦×™×•×ª ×—×™×©×•×‘ ×¦×™×•× ×™×
        function calculateTransactionsScore(count) {
            if (count >= 100) return 1;
            if (count >= 50) return 0.8;
            if (count >= 20) return 0.6;
            if (count >= 10) return 0.4;
            if (count >= 5) return 0.2;
            return count === 0 ? 0 : 0.1;
        }

        function calculateReturnedChecksScore(count) {
            return count === 0 ? 1 : Math.max(0, 1 - count * 0.2);
        }

        function calculateCreditDaysScore(days) {
            return days <= 30 ? 1 : Math.max(0, 1 - (days - 30) / 60);
        }

        function calculateDBScore(score) {
            return score >= 30 ? score / 100 : Math.max(0, (score / 100) - 0.3);
        }

        function calculateSectorScore(score) {
            return score >= 32 ? score / 100 : Math.max(0, (score / 100) - 0.3);
        }

        function calculateSectorRiskScore(dbScore, sectorScore) {
            return dbScore >= sectorScore ? 0 : Math.min(0, (dbScore - sectorScore) / 50) * 10;
        }

        function calculateCompanyAgeScore(age) {
            if (age >= 30) return 1;
            if (age >= 20) return 0.8;
            if (age >= 10) return 0.6;
            if (age >= 5) return 0.4;
            if (age >= 3) return 0.2;
            return 0.1;
        }

        function calculateTurnoverScore(turnover) {
            return Math.min(turnover / 50000000, 1);
        }

        // ×¤×•× ×§×¦×™×•×ª ×§×‘×œ×ª ×¡×™×‘×•×ª
        function getTransactionsReason(count) {
            if (count === 0) return '××™×Ÿ ×¢×¡×§××•×ª ×§×•×“××•×ª - ××•×©×š ×—×“×©';
            if (count >= 50) return `${count} ×¢×¡×§××•×ª - ××•×©×š ×× ×•×¡×”`;
            if (count >= 10) return `${count} ×¢×¡×§××•×ª - ××•×©×š ×¤×¢×™×œ`;
            return `${count} ×¢×¡×§××•×ª - ××•×©×š ×—×“×© ×™×—×¡×™×ª`;
        }

        function getReturnedChecksReason(count) {
            if (count === 0) return '××™×Ÿ ×—×–×¨×•×ª ×©×™×§×™× - × ×§×™';
            if (count <= 2) return `${count} ×—×–×¨×•×ª - ×‘×¡×“×¨`;
            return `${count} ×—×–×¨×•×ª ×©×™×§×™× - ×‘×¢×™×™×ª×™`;
        }

        function getCreditDaysReason(days) {
            if (days <= 30) return '×™××™ ××©×¨××™ ×ª×§×™× ×™×';
            if (days <= 60) return '×™××™ ××©×¨××™ ×’×‘×•×”×™× ××”×××•×¦×¢';
            return '×™××™ ××©×¨××™ ×’×‘×•×”×™× ×××•×“ - ×ª× ××™ ××©×¨××™ ×§×©×™×';
        }

        function getDBReason(score) {
            if (score <= 20) return '×¦×™×•×Ÿ D&B × ××•×š ×××•×“ - BADâŒ';
            if (score <= 30) return '×¦×™×•×Ÿ D&B × ××•×š - NOâ˜¢ï¸';
            if (score <= 50) return '×¦×™×•×Ÿ D&B ×‘×™× ×•× ×™ - OKâœ…';
            if (score <= 75) return '×¦×™×•×Ÿ D&B ×˜×•×‘ - GOODğŸ˜Š';
            return '×¦×™×•×Ÿ D&B ××¢×•×œ×” - VERY GOODğŸ˜€';
        }

        function getSectorReason(score) {
            if (score <= 25) return '×“×™×¨×•×’ ×¢× ×£ × ××•×š ×××•×“';
            if (score <= 35) return '×“×™×¨×•×’ ×¢× ×£ × ××•×š';
            if (score <= 50) return '×“×™×¨×•×’ ×¢× ×£ ×‘×™× ×•× ×™';
            return '×“×™×¨×•×’ ×¢× ×£ ×˜×•×‘';
        }

        function getSectorRiskReason(dbScore, sectorScore) {
            if (dbScore < sectorScore) return '××¡×•×›× ×ª ××”×¢× ×£ ×©×œ×” - ×¦×™×•×Ÿ D&B × ××•×š ××”×¢× ×£';
            if (dbScore === sectorScore) return '××“×•×¨×’×ª ×›××• ×”×¢× ×£';
            return '×—×‘×¨×” ××“×•×¨×’×ª ××¢×œ ×”×¢× ×£';
        }

        function getCompanyAgeReason(age) {
            if (age === 0) return '×—×‘×¨×” ×—×“×©×” - ×œ×”×–×”×¨';
            if (age >= 30) return '×—×‘×¨×” ×•×ª×™×§×”';
            if (age >= 10) return '×—×‘×¨×” ×‘×©×œ×”';
            if (age >= 5) return '×—×‘×¨×” ××ª×¤×ª×—×ª';
            return '×—×‘×¨×” ×¦×¢×™×¨×”';
        }

        function getTurnoverReason(turnover) {
            if (turnover === 0) return '××™×Ÿ × ×ª×•× ×™ ××—×–×•×¨×™×';
            if (turnover >= 50000000) return `××—×–×•×¨ ×’×‘×•×”: â‚ª${turnover.toLocaleString()}`;
            if (turnover >= 10000000) return `××—×–×•×¨ ×‘×™× ×•× ×™: â‚ª${turnover.toLocaleString()}`;
            return `××—×–×•×¨ × ××•×š: â‚ª${turnover.toLocaleString()}`;
        }

        // ×¤×•× ×§×¦×™×•×ª ×§×‘×œ×ª ×¡×˜×˜×•×¡
        function getTransactionsStatus(count) {
            if (count === 0) return 'missing';
            if (count >= 10) return 'positive';
            return 'neutral';
        }

        function getReturnedChecksStatus(count) {
            if (count === 0) return 'positive';
            if (count <= 2) return 'neutral';
            return 'negative';
        }

        function getCreditDaysStatus(days) {
            if (days <= 30) return 'positive';
            if (days <= 60) return 'neutral';
            return 'negative';
        }

        function getDBStatus(score) {
            if (score <= 30) return 'negative';
            if (score >= 50) return 'positive';
            return 'neutral';
        }

        function getSectorStatus(score) {
            if (score >= 40) return 'positive';
            if (score >= 30) return 'neutral';
            return 'negative';
        }

        function getSectorRiskStatus(dbScore, sectorScore) {
            if (dbScore < sectorScore) return 'negative';
            return 'neutral';
        }

        function getCompanyAgeStatus(age) {
            if (age === 0) return 'negative';
            if (age >= 10) return 'positive';
            return 'neutral';
        }

        function getTurnoverStatus(turnover) {
            if (turnover === 0) return 'missing';
            if (turnover >= 10000000) return 'positive';
            return 'neutral';
        }

        // ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×—×™×©×•×‘×™ ×”×™×¡×˜×•×¨×™×”
        function countPayerTransactions(payerID) {
            return transactionsData.filter(t => t['××¡×¤×¨ ×–×”×•×ª ××•×©×š'] === payerID).length;
        }

        function sumPayerTransactions(payerID) {
            return transactionsData
                .filter(t => t['××¡×¤×¨ ×–×”×•×ª ××•×©×š'] === payerID)
                .reduce((sum, t) => sum + (parseFloat(t['×¡×›×•×']) || 0), 0);
        }

        function countReturnedChecks(payerID) {
            return transactionsData.filter(t => 
                t['××¡×¤×¨ ×–×”×•×ª ××•×©×š'] === payerID && 
                (t['×¡×˜×˜×•×¡'] === '×©×™×§ ×©×—×–×¨' || t['×¡×˜×˜×•×¡'] === '×”×•×©×‘ ×œ×œ×§×•×—')
            ).length;
        }

        function countCustomerTransactions(customerID) {
            return transactionsData.filter(t => t['×.×–×”×•×ª'] === customerID).length;
        }

        function sumCustomerTransactions(customerID) {
            return transactionsData
                .filter(t => t['×.×–×”×•×ª'] === customerID)
                .reduce((sum, t) => sum + (parseFloat(t['×¡×›×•×']) || 0), 0);
        }

        // × ×ª×•× ×™ ×‘×¨×™×¨×ª ××—×“×œ
        function getDefaultPayerData() {
            return {
                name: '',
                id: '',
                transactions: 0,
                totalAmount: 0,
                returnedChecks: 0,
                dbScore: 38.704,
                sectorScore: 29,
                companyAge: 0,
                employeeCount: 0,
                annualTurnover: 0
            };
        }

        function getDefaultCustomerData() {
            return {
                name: '',
                id: '',
                transactions: 0,
                totalAmount: 0
            };
        }

        function getDefaultDBData() {
            return {
                '×¡×§×•×¨': 38.704,
                '×¡×§×•×¨ ×¢× ×£': 29,
                '×©× ×•×ª ×•×ª×§': 0,
                '××¡\' ××•×¢×¡×§×™×': 0,
                '××—×–×•×¨ ×‘×\' â‚ª': 0
            };
        }

        // ×§×‘×œ×ª ×“×™×¨×•×’ ××¦×™×•×Ÿ
        function getRatingFromScore(score) {
            if (score >= 90) return 'AAA';
            if (score >= 80) return 'AA';
            if (score >= 70) return 'A';
            if (score >= 60) return 'BBB';
            if (score >= 50) return 'BB';
            if (score >= 40) return 'B';
            if (score >= 30) return 'CCC';
            return 'D';
        }

        // ×§×‘×œ×ª ×”××œ×¦×”
        function getRecommendation(score) {
            if (score >= 70) {
                return { recommendation: '××•××œ×¥', recommendationClass: 'positive' };
            } else if (score >= 50) {
                return { recommendation: '×‘×‘×“×™×§×” × ×•×¡×¤×ª', recommendationClass: 'warning' };
            } else {
                return { recommendation: '×œ× ××•××œ×¥', recommendationClass: '' };
            }
        }

        // ×”×¦×’×ª ×ª×•×¦××•×ª (×›××• ×‘×’×¨×¡×” ×”×§×•×“××ª)
        function displayResults(results) {
            const resultsSection = document.getElementById('resultsSection');
            const ratingDisplay = document.getElementById('ratingDisplay');
            const detailsGrid = document.getElementById('detailsGrid');
            const parametersGrid = document.getElementById('parametersGrid');
            const recommendationDiv = document.getElementById('recommendation');

            // ×”×¦×’×ª ×“×™×¨×•×’ ×¨××©×™
            ratingDisplay.innerHTML = `
                <div class="rating-card">
                    <div class="rating-score rating-${results.rating}">${results.finalScore.toFixed(1)}</div>
                    <div>×¦×™×•×Ÿ ×¡×•×¤×™</div>
                </div>
                <div class="rating-card">
                    <div class="rating-score rating-${results.rating}">${results.rating}</div>
                    <div>×“×™×¨×•×’ ××©×¨××™</div>
                </div>
                <div class="rating-card">
                    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“Š</div>
                    <div>×¨××ª ×¡×™×›×•×Ÿ: ${results.finalScore >= 70 ? '× ××•×›×”' : results.finalScore >= 50 ? '×‘×™× ×•× ×™×ª' : '×’×‘×•×”×”'}</div>
                </div>
            `;

            // ×”×¦×’×ª ×¤×¨×˜×™×
            detailsGrid.innerHTML = `
                <div class="detail-card">
                    <h3>×¤×¨×˜×™ ×”×¢×¡×§×”</h3>
                    <div class="detail-row">
                        <span class="detail-label">××•×©×š:</span>
                        <span class="detail-value">${results.payerName}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×—.×¤. ××•×©×š:</span>
                        <span class="detail-value">${results.payerID}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×œ×§×•×—:</span>
                        <span class="detail-value">${results.customerName}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×—.×¤. ×œ×§×•×—:</span>
                        <span class="detail-value">${results.customerID}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×¡×›×•×:</span>
                        <span class="detail-value">â‚ª${results.checkAmount.toLocaleString()}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×™××™ ××©×¨××™:</span>
                        <span class="detail-value">${results.creditDays}</span>
                    </div>
                </div>
                <div class="detail-card">
                    <h3>× ×ª×•× ×™ ××•×©×š (××”×××’×¨)</h3>
                    <div class="detail-row">
                        <span class="detail-label">×¢×¡×§××•×ª ×§×•×“××•×ª:</span>
                        <span class="detail-value">${results.payerData.transactions || 0}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×¡×›×•× ×›×•×œ×œ:</span>
                        <span class="detail-value">â‚ª${(results.payerData.totalAmount || 0).toLocaleString()}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×—×–×¨×•×ª ×©×™×§×™×:</span>
                        <span class="detail-value">${results.payerData.returnedChecks || 0}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×¦×™×•×Ÿ D&B:</span>
                        <span class="detail-value">${results.dbRecord?.['×¡×§×•×¨'] || results.payerData.dbScore || 38.704}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×¦×™×•×Ÿ ×¢× ×£:</span>
                        <span class="detail-value">${results.dbRecord?.['×¡×§×•×¨ ×¢× ×£'] || results.payerData.sectorScore || 29}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×’×™×œ ×—×‘×¨×”:</span>
                        <span class="detail-value">${results.dbRecord?.['×©× ×•×ª ×•×ª×§'] || results.payerData.companyAge || 0} ×©× ×™×</span>
                    </div>
                </div>
                <div class="detail-card">
                    <h3>× ×ª×•× ×™ ×œ×§×•×— (××”×××’×¨)</h3>
                    <div class="detail-row">
                        <span class="detail-label">×¢×¡×§××•×ª ×§×•×“××•×ª:</span>
                        <span class="detail-value">${results.customerData.transactions || 0}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">×¡×›×•× ×›×•×œ×œ:</span>
                        <span class="detail-value">â‚ª${(results.customerData.totalAmount || 0).toLocaleString()}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">××¡×¤×¨ ×¢×•×‘×“×™×:</span>
                        <span class="detail-value">${results.dbRecord?.['××¡\' ××•×¢×¡×§×™×'] || '×œ× ×™×“×•×¢'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">××—×–×•×¨ ×©× ×ª×™:</span>
                        <span class="detail-value">${results.dbRecord?.['××—×–×•×¨ ×‘×\' â‚ª'] ? 'â‚ª' + parseInt(results.dbRecord['××—×–×•×¨ ×‘×\' â‚ª']).toLocaleString() : '×œ× ×™×“×•×¢'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">××§×•×¨ × ×ª×•× ×™×:</span>
                        <span class="detail-value">${transactionsData.length > 0 ? '×§×‘×¦×™× ×××™×ª×™×™×' : '× ×ª×•× ×™ ×“×•×’××”'}</span>
                    </div>
                </div>
            `;

            // ×”×¦×’×ª ×¤×¨××˜×¨×™×
            let parametersHTML = `
                <div class="parameter-item" style="font-weight: bold; background: #f8f9fa;">
                    <div>×¤×¨××˜×¨</div>
                    <div>××©×§×œ</div>
                    <div>×¢×¨×š ×’×•×œ××™</div>
                    <div>×¢×¨×š ×× ×•×¨××œ</div>
                    <div>×¡×˜×˜×•×¡</div>
                </div>
            `;
            
            results.parameters.forEach(param => {
                parametersHTML += `
                    <div class="parameter-item">
                        <div>
                            <div class="parameter-name">${param.name}</div>
                            <div class="parameter-reason">${param.reason}</div>
                        </div>
                        <div>${param.weight}%</div>
                        <div>${param.rawValue}</div>
                        <div>${param.normalizedValue.toFixed(3)}</div>
                        <div>
                            <span class="status-badge status-${param.status}">
                                ${param.status === 'positive' ? '×—×™×•×‘×™' : 
                                  param.status === 'negative' ? '×©×œ×™×œ×™' : 
                                  param.status === 'missing' ? '×—×¡×¨' : '× ×™×˜×¨×œ×™'}
                            </span>
                        </div>
                    </div>
                `;
            });

            parametersGrid.innerHTML = parametersHTML;

            // ×”×¦×’×ª ×”××œ×¦×”
            recommendationDiv.className = `recommendation ${results.recommendationClass}`;
            recommendationDiv.innerHTML = `
                <div style="font-size: 1.5em; margin-bottom: 10px;">
                    ${results.recommendation === '××•××œ×¥' ? 'âœ…' : results.recommendation === '×‘×‘×“×™×§×” × ×•×¡×¤×ª' ? 'âš ï¸' : 'âŒ'}
                </div>
                <div>×”××œ×¦×” ×¡×•×¤×™×ª: ${results.recommendation}</div>
                ${results.finalScore < 30 ? '<div style="margin-top: 10px; font-size: 0.9em;">×¢×¡×§×” ×‘×¡×™×›×•×Ÿ ×’×‘×•×” - × ×“×¨×©×ª ×‘×“×™×§×” ××¢××™×§×”</div>' : ''}
                ${transactionsData.length > 0 ? '<div style="margin-top: 10px; font-size: 0.9em;">âœ… ××‘×•×¡×¡ ×¢×œ × ×ª×•× ×™× ×××™×ª×™×™× ××”×××’×¨</div>' : '<div style="margin-top: 10px; font-size: 0.9em;">âš ï¸ ××‘×•×¡×¡ ×¢×œ × ×ª×•× ×™ ×“×•×’××”</div>'}
            `;

            // ×”×¦×’×ª ×ª×•×¦××•×ª
            resultsSection.style.display = 'block';
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // ××™×¤×•×¡ ×”×˜×•×¤×¡
        function resetForm() {
            document.getElementById('payerName').value = '';
            document.getElementById('payerID').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerID').value = '';
            document.getElementById('checkAmount').value = '';
            document.getElementById('paymentDate').value = '';
            document.getElementById('bankCode').value = '';
            document.getElementById('branchCode').value = '';
            document.getElementById('accountNumber').value = '';
            
            document.getElementById('resultsSection').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ×˜×¢×™× ×ª ×“×•×’××”
        function loadExample() {
            document.getElementById('payerName').value = '×”×“×¨ ×‘× ×™×” ××—×–×§×”';
            document.getElementById('payerID').value = '200353902';
            document.getElementById('customerName').value = '××™×‘×¨×”×™× ×¨××‘×™';
            document.getElementById('customerID').value = '305346900';
            document.getElementById('checkAmount').value = '50000';
            document.getElementById('bankCode').value = '20';
            document.getElementById('branchCode').value = '512';
            
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 46);
            document.getElementById('paymentDate').value = futureDate.toISOString().split('T')[0];
        }

        // ××ª×—×•×œ ×”××¢×¨×›×ª
        window.addEventListener('load', initializeSystem);
    </script>
</body>
</html>
    </script><!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×—×™×ª×•× ××©×¨××™ ××ª×§×“××ª</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .input-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .results-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: none;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e1e8ed;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .autocomplete-suggestion {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f8f9fa;
        }

        .autocomplete-suggestion:hover {
            background: #f8f9fa;
        }

        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }

        .suggestion-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .suggestion-id {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 2px;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .rating-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .rating-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .rating-score {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .rating-D { color: #e74c3c; }
        .rating-CCC { color: #e67e22; }
        .rating-B { color: #f39c12; }
        .rating-BB { color: #f1c40f; }
        .rating-BBB { color: #f39c12; }
        .rating-A { color: #27ae60; }
        .rating-AA { color: #2ecc71; }
        .rating-AAA { color: #27ae60; }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .detail-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .detail-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .detail-label {
            color: #7f8c8d;
        }

        .detail-value {
            font-weight: 600;
            color: #2c3e50;
        }

        .parameters-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .parameter-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
            align-items: center;
        }

        .parameter-item:last-child {
            border-bottom: none;
        }

        .parameter-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .parameter-reason {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
        }

        .status-positive { background: #d5f4e6; color: #27ae60; }
        .status-negative { background: #fadbd8; color: #e74c3c; }
        .status-neutral { background: #eaecee; color: #7f8c8d; }
        .status-missing { background: #fdf2e9; color: #e67e22; }

        .recommendation {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
            font-weight: 600;
        }

        .recommendation.positive {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .recommendation.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .file-upload {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #3498db;
            background: #f0f8ff;
        }

        .file-upload input {
            display: none;
        }

        .file-upload label {
            cursor: pointer;
            color: #3498db;
            font-weight: 600;
        }

        .data-status {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .data-status h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-item-name {
            color: #34495e;
            font-weight: 500;
        }

        .data-item-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-loaded { background: #d5f4e6; color: #27ae60; }
        .status-missing { background: #fadbd8; color: #e74c3c; }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .rating-display {
                grid-template-columns: 1fr;
            }
            
            .parameter-item {
                grid-template-columns: 1fr;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¦ ××¢×¨×›×ª ×—×™×ª×•× ××©×¨××™ ××ª×§×“××ª</h1>
            <p>×”×¢×¨×›×ª ×¡×™×›×•× ×™× ×•×—×™×©×•×‘ ×“×™×¨×•×’ ××©×¨××™ ×¢×œ ×‘×¡×™×¡ 16 ×¤×¨××˜×¨×™×</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2 style="margin-bottom: 25px; color: #2c3e50;">×¤×¨×˜×™ ×”×©×™×§ ×•×”××•×©×š</h2>
                
                <div class="data-status" id="dataStatus">
                    <h3>×¡×˜×˜×•×¡ ×§×‘×¦×™ × ×ª×•× ×™×</h3>
                    <div class="data-item">
                        <span class="data-item-name">×’×™×œ×™×•×Ÿ ×¢×¡×§××•×ª</span>
                        <span class="data-item-status status-missing" id="status-transactions">×œ× × ×˜×¢×Ÿ</span>
                    </div>
                    <div class="data-item">
                        <span class="data-item-name">× ×ª×•× ×™ ××•×©×›×™×</span>
                        <span class="data-item-status status-missing" id="status-payers">×œ× × ×˜×¢×Ÿ</span>
                    </div>
                    <div class="data-item">
                        <span class="data-item-name">× ×ª×•× ×™ ×œ×§×•×—×•×ª</span>
                        <span class="data-item-status status-missing" id="status-customers">×œ× × ×˜×¢×Ÿ</span>
                    </div>
                    <div class="data-item">
                        <span class="data-item-name">× ×ª×•× ×™ D&B</span>
                        <span class="data-item-status status-missing" id="status-db">×œ× × ×˜×¢×Ÿ</span>
                    </div>
                    <div class="data-item">
                        <span class="data-item-name">× ×ª×•× ×™ ×‘× ×§×™×</span>
                        <span class="data-item-status status-missing" id="status-banks">×œ× × ×˜×¢×Ÿ</span>
                    </div>
                </div>

                <div class="file-upload">
                    <label for="dataFiles">ğŸ“ ×”×¢×œ×” ×§×‘×¦×™ × ×ª×•× ×™× (Excel/CSV)</label>
                    <input type="file" id="dataFiles" multiple accept=".xlsx,.xls,.csv">
                    <p style="margin-top: 10px; font-size: 12px; color: #7f8c8d;">
                        ×§×‘×¦×™× × ×“×¨×©×™×: ×›×œ×”× ×ª×•× ×™×6.11.22.xlsx, ×—×™×ª×•× ××©×¨××™.xlsx, ×§×‘×¦×™ ×©×™×§×™× ×—×•×–×¨×™×
                    </p>
                </div>
                
                <div class="form-group">
                    <label for="payerName">×©× ××•×©×š</label>
                    <div class="autocomplete-container">
                        <input type="text" id="payerName" placeholder="×”×ª×—×œ ×œ×”×§×œ×™×“ ×©× ××•×©×š..." autocomplete="off">
                        <div id="payerSuggestions" class="autocomplete-suggestions"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="payerID">×—.×¤./×¢.×. ××•×©×š</label>
                    <input type="text" id="payerID" placeholder="×™×ª××œ× ××•×˜×•××˜×™" readonly style="background: #f8f9fa;">
                </div>

                <div class="form-group">
                    <label for="customerName">×©× ×œ×§×•×—</label>
                    <div class="autocomplete-container">
                        <input type="text" id="customerName" placeholder="×”×ª×—×œ ×œ×”×§×œ×™×“ ×©× ×œ×§×•×—..." autocomplete="off">
                        <div id="customerSuggestions" class="autocomplete-suggestions"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="customerID">×—.×¤./×¢.×. ×œ×§×•×—</label>
                    <input type="text" id="customerID" placeholder="×™×ª××œ× ××•×˜×•××˜×™" readonly style="background: #f8f9fa;">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="checkAmount">×¡×›×•× ×”×©×™×§</label>
                        <input type="number" id="checkAmount" placeholder="×¡×›×•× ×‘×©×´×—">
                    </div>
                    <div class="form-group">
                        <label for="paymentDate">×ª××¨×™×š ×¤×™×¨×¢×•×Ÿ</label>
                        <input type="date" id="paymentDate">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="bankCode">×‘× ×§</label>
                        <input type="text" id="bankCode" placeholder="×§×•×“ ×‘× ×§">
                    </div>
                    <div class="form-group">
                        <label for="branchCode">×¡× ×™×£</label>
                        <input type="text" id="branchCode" placeholder="×§×•×“ ×¡× ×™×£">
                    </div>
                </div>

                <div class="form-group">
                    <label for="accountNumber">××¡×¤×¨ ×—×©×‘×•×Ÿ</label>
                    <input type="text" id="accountNumber" placeholder="××¡×¤×¨ ×—×©×‘×•×Ÿ">
                </div>

                <button class="btn" onclick="calculateRating()">
                    ğŸ§® ×—×©×‘ ×“×™×¨×•×’ ××©×¨××™ ××ª×§×“×
                </button>

                <button class="btn" style="background: #95a5a6; margin-top: 10px;" onclick="loadExample()">
                    ğŸ“‹ ×˜×¢×Ÿ ×“×•×’××” ××”×™×¨×”
                </button>
            </div>

            <div class="results-section" id="resultsSection">
                <div class="rating-display" id="ratingDisplay">
                    <!-- ×ª×•×¦××•×ª ×™×•×¦×’×• ×›××Ÿ -->
                </div>

                <div class="details-grid" id="detailsGrid">
                    <!-- ×¤×¨×˜×™× ×™×•×¦×’×• ×›××Ÿ -->
                </div>

                <div class="parameters-section">
                    <h3 style="margin-bottom: 20px; color: #2c3e50;">×¤×™×¨×•×˜ ×¤×¨××˜×¨×™ ×”×“×™×¨×•×’ (16 ×¤×¨××˜×¨×™×)</h3>
                    <div id="parametersGrid">
                        <!-- ×¤×¨××˜×¨×™× ×™×•×¦×’×• ×›××Ÿ -->
                    </div>
                </div>

                <div id="recommendation" class="recommendation">
                    <!-- ×”××œ×¦×” ×ª×•×¦×’ ×›××Ÿ -->
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" style="width: auto; margin-right: 10px;" onclick="window.print()">
                        ğŸ–¨ï¸ ×”×“×¤×¡ ×“×•×—
                    </button>
                    <button class="btn" style="width: auto; background: #95a5a6;" onclick="resetForm()">
                        ğŸ”„ ×¢×¡×§×” ×—×“×©×”
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ×œ××—×¡×•×Ÿ ×”× ×ª×•× ×™×
        let transactionsData = [];
        let payersData = [];
        let customersData = [];
        let dbData = [];
        let banksData = [];

        // × ×ª×•× ×™ ×“×•×’××” ×¨××©×•× ×™×™×
        const sampleData = {
            payers: [
                { name: '×”×“×¨ ×‘× ×™×” ××—×–×§×”', id: '200353902', dbScore: 38.704, sectorScore: 29 },
                { name: '××™×‘×¨×”×™× ×¨××‘×™', id: '305346900', dbScore: 45.2, sectorScore: 32 },
                { name: '×—×‘×¨×ª ×”×‘× ×™×™×” ×”×’×“×•×œ×”', id: '123456789', dbScore: 72.5, sectorScore: 65 },
                { name: '××©×” ×›×”×Ÿ', id: '987654321', dbScore: 55.8, sectorScore: 50 }
            ],
            customers: [
                { name: '××™×‘×¨×”×™× ×¨××‘×™', id: '305346900' },
                { name: '×©×¨×” ×œ×•×™', id: '123456788' },
                { name: '×“×•×“ ×™×©×¨××œ×™', id: '111222333' },
                { name: '××™×¨×‘ ×¤×•×œ×§', id: '444555666' }
            ]
        };

        // ××ª×—×•×œ ×”××¢×¨×›×ª
        function initializeSystem() {
            setupFileUpload();
            setupAutocomplete();
            loadSampleData();
        }

        // ×”×’×“×¨×ª ×”×¢×œ××ª ×§×‘×¦×™×
        function setupFileUpload() {
            document.getElementById('dataFiles').addEventListener('change', handleFileUpload);
        }

        // ×˜×™×¤×•×œ ×‘×”×¢×œ××ª ×§×‘×¦×™×
        async function handleFileUpload(event) {
            const files = event.target.files;
            
            for (let file of files) {
                try {
                    const fileName = file.name.toLowerCase();
                    
                    if (fileName.includes('×›×œ×”× ×ª×•× ×™×') || fileName.includes('×’×™×œ×™×•×Ÿ1')) {
                        await loadTransactionsFile(file);
                        updateDataStatus('transactions', '× ×˜×¢×Ÿ ×‘×”×¦×œ×—×”');
                    } 
                    else if (fileName.includes('×—×™×ª×•× ××©×¨××™') || fileName.includes('score')) {
                        await loadDBFile(file);
                        updateDataStatus('db', '× ×˜×¢×Ÿ ×‘×”×¦×œ×—×”');
                    }
                    else if (fileName.includes('×©×™×§×™×') && fileName.includes('×—×•×–×¨×™×')) {
                        await loadReturnedChecksFile(file);
                    }
                    else if (fileName.includes('sigma')) {
                        await loadSigmaFile(file);
                    }
                    
                } catch (error) {
                    console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×§×•×‘×¥:', file.name, error);
                    alert(`×©×’×™××” ×‘×˜×¢×™× ×ª ×§×•×‘×¥ ${file.name}: ${error.message}`);
                }
            }
        }

        // ×˜×¢×™× ×ª ×§×•×‘×¥ ×¢×¡×§××•×ª
        async function loadTransactionsFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                        
                        // ×¢×™×‘×•×“ ×”× ×ª×•× ×™×
                        processTransactionsData(jsonData);
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.readAsArrayBuffer(file);
            });
        }

        // ×¢×™×‘×•×“ × ×ª×•× ×™ ×¢×¡×§××•×ª
        function processTransactionsData(rawData) {
            const headers = rawData[0];
            transactionsData = [];
            payersData = [];
            customersData = [];
            
            for (let i = 1; i < rawData.length; i++) {
                const row = rawData[i];
                if (!row || row.length === 0) continue;
                
                const transaction = {};
                headers.forEach((header, index) => {
                    transaction[header] = row[index];
                });
                
                transactionsData.push(transaction);
                
                // ××™×¡×•×£ ××•×©×›×™× ×•×œ×§×•×—×•×ª
                if (transaction['×©× ××•×©×š'] && transaction['××¡×¤×¨ ×–×”×•×ª ××•×©×š']) {
                    const existingPayer = payersData.find(p => p.id === transaction['××¡×¤×¨ ×–×”×•×ª ××•×©×š']);
                    if (!existingPayer) {
                        payersData.push({
                            name: transaction['×©× ××•×©×š'],
                            id: transaction['××¡×¤×¨ ×–×”×•×ª ××•×©×š'],
                            transactions: 1,
                            totalAmount: parseFloat(transaction['×¡×›×•×']) || 0
                        });
                    } else {
                        existingPayer.transactions++;
                        existingPayer.totalAmount += parseFloat(transaction['×¡×›×•×']) || 0;
                    }
                }
                
                if (transaction['×©× ×œ×§×•×—'] && transaction['×.×–×”×•×ª']) {
                    const existingCustomer = customersData.find(c => c.id === transaction['×.×–×”×•×ª']);
                    if (!existingCustomer) {
                        customersData.push({
                            name: transaction['×©× ×œ×§×•×—'],
                            id: transaction['×.×–×”×•×ª']
                        });
                    }
                }
            }
            
            updateDataStatus('payers', `${payersData.length} ××•×©×›×™×`);
            updateDataStatus('customers', `${customersData.length} ×œ×§×•×—×•×ª`);
            refreshAutocomplete();
        }

        // ×˜×¢×™× ×ª ×§×•×‘×¥ D&B
        async function loadDBFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        
                        // ×—×™×¤×•×© ×’×™×œ×™×•×Ÿ scoreM_N
                        const scoreMNSheet = workbook.Sheets['scoreM_N'] || workbook.Sheets[workbook.SheetNames[0]];
                        if (scoreMNSheet) {
                            const jsonData = XLSX.utils.sheet_to_json(scoreMNSheet, { header: 1 });
                            processDBData(jsonData);
                        }
                        
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.readAsArrayBuffer(file);
            });
        }

        // ×¢×™×‘×•×“ × ×ª×•× ×™ D&B
        function processDBData(rawData) {
            const headers = rawData[0];
            dbData = [];
            
            for (let i = 1; i < rawData.length; i++) {
                const row = rawData[i];
                if (!row || row.length === 0) continue;
                
                const dbRecord = {};
                headers.forEach((header, index) => {
                    dbRecord[header] = row[index];
                });
                
                dbData.push(dbRecord);
            }
        }

        // ×˜×¢×™× ×ª × ×ª×•× ×™ ×“×•×’××”
        function loadSampleData() {
            payersData = [...sampleData.payers];
            customersData = [...sampleData.customers];
            
            updateDataStatus('payers', `${payersData.length} ××•×©×›×™× (×“×•×’××”)`);
            updateDataStatus('customers', `${customersData.length} ×œ×§×•×—×•×ª (×“×•×’××”)`);
            refreshAutocomplete();
        }

        // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ × ×ª×•× ×™×
        function updateDataStatus(type, status) {
            const statusElement = document.getElementById(`status-${type}`);
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.className = 'data-item-status status-loaded';
            }
        }

        // ×”×’×“×¨×ª autocomplete
        function setupAutocomplete() {
            const payerInput = document.getElementById('payerName');
            const customerInput = document.getElementById('customerName');
            
            payerInput.addEventListener('input', (e) => showSuggestions(e, 'payers'));
            customerInput.addEventListener('input', (e) => showSuggestions(e, 'customers'));
            
            // ×¡×’×™×¨×ª suggestions ×‘×¢×ª ×œ×—×™×¦×” ×‘×—×•×¥
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.autocomplete-container')) {
                    hideSuggestions();
                }
            });
        }

        // ×”×¦×’×ª ×”×¦×¢×•×ª
        function showSuggestions(event, type) {
            const input = event.target;
            const query = input.value.toLowerCase();
            const suggestionsId = type === 'payers' ? 'payerSuggestions' : 'customerSuggestions';
            const suggestionsContainer = document.getElementById(suggestionsId);
            
            if (query.length < 2) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            const data = type === 'payers' ? payersData : customersData;
            const filtered = data.filter(item => 
                item.name.toLowerCase().includes(query)
            ).slice(0, 10);
            
            if (filtered.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            suggestionsContainer.innerHTML = filtered.map(item => `
                <div class="autocomplete-suggestion" onclick="selectSuggestion('${type}', '${item.name}', '${item.id}')">
                    <div class="suggestion-name">${item.name}</div>
                    <div class="suggestion-id">${item.id}</div>
                </div>
            `).join('');
            
            suggestionsContainer.style.display = 'block';
        }

        // ×‘×—×™×¨×ª ×”×¦×¢×”
        function selectSuggestion(type, name, id) {
            if (type === 'payers') {
                document.getElementById('payerName').value = name;
                document.getElementById('payerID').value = id;
            } else {
                document.getElementById('customerName').value = name;
                document.getElementById('customerID').value = id;
            }
            
            hideSuggestions();
        }

        // ×”×¡×ª×¨×ª ×”×¦×¢×•×ª
        function hideSuggestions() {
            document.getElementById('payerSuggestions').style.display = 'none';
            document.getElementById('customerSuggestions').
