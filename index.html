<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת חיתום אשראי</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.4.1/papaparse.min.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <h1>🏦 מערכת חיתום אשראי</h1>
            <form class="login-form" onsubmit="return loginUser(event)">
                <div class="form-group">
                    <label for="username">שם משתמש</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">סיסמה</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="login-btn">התחבר</button>
                <div id="loginError" class="error-message" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="header-content">
                    <h1>🏦 מערכת חיתום אשראי מתקדמת</h1>
                    <p>חישוב דירוג אשראי מבוסס נתונים היסטוריים מדויקים</p>
                </div>
                <div class="user-info">
                    <span id="currentUser"></span><br>
                    <button onclick="logoutUser()" class="logout-btn">התנתק</button>
                </div>
            </div>

            <div class="main-content">
                <!-- Input Section -->
                <div class="input-section">
                    <h2 style="margin-bottom: 20px; color: #2c3e50;">נתוני העסקה</h2>
                    
                    <!-- Data Status -->
                    <div class="data-status">
                        <h3>סטטוס נתונים</h3>
                        <div class="status-item">
                            <span>📊 עסקאות היסטוריות</span>
                            <span id="transactionsStatus" class="status-error">❌ לא נטען</span>
                        </div>
                        <div class="status-item">
                            <span>📈 שיקים חוזרים</span>
                            <span id="returnedStatus" class="status-error">❌ לא נטען</span>
                        </div>
                        <div class="status-item">
                            <span>⚠️ דירוגים חיצוניים</span>
                            <span id="warningsStatus" class="status-error">❌ לא נטען</span>
                        </div>
                    </div>

                    <!-- File Upload Section -->
                    <div class="excel-upload-section">
                        <h4 style="margin-bottom: 15px; color: #2c3e50;">📁 טעינת קבצי נתונים</h4>
                        
                        <div style="margin-bottom: 10px;">
                            <label>📊 קובץ עסקאות ראשי (גיליון1):</label>
                            <input type="file" id="mainExcelFile" accept=".xlsx,.xls" style="width: 100%; padding: 8px; margin-top: 5px;">
                        </div>
                        
                        <div style="margin-bottom: 10px;">
                            <label>🏆 קובץ דירוגי אשראי (scoreM_N):</label>
                            <input type="file" id="scoresFile" accept=".xlsx,.xls,.csv" style="width: 100%; padding: 8px; margin-top: 5px;">
                        </div>
                        
                        <div style="margin-bottom: 10px;">
                            <label>📈 קובץ שיקים חוזרים:</label>
                            <input type="file" id="returnedFile" accept=".xlsx,.xls,.csv" style="width: 100%; padding: 8px; margin-top: 5px;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label>⚠️ קובץ אכ"מ/ביטולים:</label>
                            <input type="file" id="warningsFile" accept=".xlsx,.xls,.csv" style="width: 100%; padding: 8px; margin-top: 5px;">
                        </div>
                        
                        <button onclick="loadAllDataFiles()" style="width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            🔄 טען כל הקבצים
                        </button>
                        
                        <div style="margin-top: 10px; padding: 10px; background: #e7f3ff; border-radius: 5px; font-size: 12px;">
                            <strong>💡 עצה:</strong> תוכל לטעון קובץ יחיד עם כל הגיליונות או קבצים נפרדים
                        </div>
                        
                        <div style="margin-top: 10px; padding: 10px; background: #e7f3ff; border-radius: 5px; font-size: 12px;">
                            <strong>🔒 פרטיות מובטחת:</strong> הקבצים נקראים רק במחשב שלך ולא נשלחים לשרת
                        </div>
                    </div>

                    <!-- Transaction Details Form -->
                    <div class="form-group">
                        <label for="payerName">שם מושך</label>
                        <input type="text" id="payerName" placeholder="הזן או בחר שם מושך" autocomplete="off">
                        <div id="payerNameSuggestions" class="autocomplete-suggestions"></div>
                    </div>

                    <div class="form-group">
                        <label for="payerID">ח.פ./ת.ז. מושך</label>
                        <input type="text" id="payerID" placeholder="יתמלא אוטומטית או הזן ידנית">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="checkAmount">סכום השיק</label>
                            <input type="number" id="checkAmount" placeholder="סכום בש״ח">
                        </div>
                        <div class="form-group">
                            <label for="creditDays">ימי אשראי</label>
                            <input type="number" id="creditDays" placeholder="ימי אשראי" value="30">
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <button class="btn" onclick="performCreditRatingCalculation()" id="calculateBtn" disabled>
                        🧮 חשב דירוג אשראי
                    </button>

                    <button class="btn" style="background: #95a5a6;" onclick="loadSampleDataForDemo()">
                        📋 טען נתוני דוגמה לבדיקה
                    </button>

                    <!-- Data Preview -->
                    <div id="dataPreview" class="data-preview" style="display: none;"></div>
                </div>

                <!-- Results Section -->
                <div class="results-section" id="resultsSection">
                    <div class="rating-display" id="ratingDisplay"></div>
                    
                    <div class="parameters-section">
                        <h3 style="margin-bottom: 15px; color: #2c3e50;">פירוט פרמטרי הדירוג</h3>
                        <div class="parameter-header">
                            <div>פרמטר</div>
                            <div>משקל</div>
                            <div>ערך גולמי</div>
                            <div>מנורמל</div>
                            <div>משוקלל</div>
                        </div>
                        <div id="parametersDisplay"></div>
                    </div>

                    <div id="recommendation" class="recommendation"></div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" style="width: auto; background: #95a5a6;" onclick="resetTransactionForm()">
                            🔄 עסקה חדשה
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/fileLoader.js"></script>
    <script src="js/dataProcessor.js"></script>
    <script src="js/ratingCalculator.js"></script>
    <script src="js/ui.js"></script>
    
    <!-- Initialize App -->
    <script>
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 מערכת חיתום אשראי נטענה בהצלחה');
            initializeApplication();
        });
    </script>
</body>
</html>
